(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&d(u)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();const y="http://localhost:3000/api/playlist",h=3e4;let l=[],c=[];const i=document.getElementById("player"),a=document.getElementById("debug"),g=e=>{for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}return e},s=e=>{console.log(e),a.innerText=e+`
`+a.innerText},m=async()=>{try{return await(await fetch(y)).json()}catch(e){return s("Error fetching playlist: "+e.message),[]}},p=async()=>{s("Polling for new videos...");const t=(await m()).filter(o=>!l.find(d=>d.id===o.id));if(t.length>0?(s(`Found ${t.length} new videos!`),l=[...l,...t],c.unshift(...t)):s("No new videos."),c.length===0&&l.length>0){s("Queue empty. Refilling from library (Shuffled).");const o=[...l];g(o),c.push(...o)}(i.paused||i.ended||!i.src)&&f()},f=()=>{if(c.length===0){s("Queue empty, waiting...");return}const e=c.shift();e.id;const t=`http://localhost:3000${e.url}`;s(`Playing: ${e.id}`),i.src=t,i.play().catch(o=>s("Play error: "+o.message))};i.addEventListener("ended",()=>{s("Video ended."),f()});i.addEventListener("error",e=>{s("Video error. Skipping."),f()});const L=async()=>{await p(),setInterval(p,h),window.addEventListener("keydown",e=>{e.key==="d"&&(a.style.display=a.style.display==="none"?"block":"none")})};L();
