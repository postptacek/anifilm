(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))g(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&g(d)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function g(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const l=12,E="http://localhost:3000/api/submit";let s=JSON.parse(localStorage.getItem("anifilm_found_frames"))||[],I=localStorage.getItem("anifilm_glitch_mode")==="true",c=null;const v=document.getElementById("landing-page"),S=document.getElementById("start-btn"),h=document.getElementById("ui-layer"),T=document.getElementById("collection-btn"),a=document.getElementById("collection-view"),B=document.getElementById("close-collection-btn"),y=document.getElementById("collection-grid"),_=document.getElementById("victory-screen"),i=document.getElementById("submit-btn"),b=document.querySelector("a-scene"),u=document.getElementById("capture-ui"),C=document.getElementById("capture-btn"),m=document.getElementById("scan-overlay");function L(){f(),p()}S.addEventListener("click",()=>{v.classList.add("hidden"),h.classList.remove("hidden")});T.addEventListener("click",()=>{f(),a.classList.remove("hidden")});B.addEventListener("click",()=>{a.classList.add("hidden")});function f(){y.innerHTML="";for(let e=0;e<l;e++){const t=document.createElement("div");t.className="grid-item",t.id=`collection-item-${e}`,t.textContent=e+1,s.includes(e)&&t.classList.add("found"),y.appendChild(t)}}function O(e){console.log(`Target ${e} found!`),!s.includes(e)&&(c=e,u.classList.remove("hidden"),m.classList.add("hidden"))}function w(e){console.log(`Target ${e} lost!`),c===e&&(c=null,u.classList.add("hidden"),m.classList.remove("hidden"))}C.addEventListener("click",()=>{c!==null&&!s.includes(c)&&(s.push(c),localStorage.setItem("anifilm_found_frames",JSON.stringify(s)),alert("FRAME COLLECTED!"),u.classList.add("hidden"),m.classList.remove("hidden"),f(),p())});function p(){s.length>=l&&(a.classList.add("hidden"),_.classList.remove("hidden"),h.classList.add("hidden"))}function A(){for(let e=0;e<l;e++){const t=document.querySelector(`#target-${e}`);t?(t.addEventListener("targetFound",()=>O(e)),t.addEventListener("targetLost",()=>w(e))):console.warn(`Target entity #target-${e} not found in HTML`)}}i.addEventListener("click",async()=>{i.disabled=!0,i.textContent="Sending...";try{const e=localStorage.getItem("anifilm_user_id")||`user_${Date.now()}`;localStorage.setItem("anifilm_user_id",e);const r=await(await fetch(E,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,foundAll:!0,glitchMode:I})})).json();if(r.success)i.textContent="SENT! CHECK THE TV",alert("Animation sent to the CRT Display!");else throw new Error(r.error)}catch(e){console.error(e),i.textContent="RETRY",i.disabled=!1,alert("Error sending data. Please try again.")}});L();b.addEventListener("loaded",A);window.unlockAll=()=>{s=Array.from({length:l},(e,t)=>t),localStorage.setItem("anifilm_found_frames",JSON.stringify(s)),L()};
