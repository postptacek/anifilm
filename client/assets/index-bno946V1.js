(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();const l=12,h="http://localhost:3000/api/submit";let r=JSON.parse(localStorage.getItem("anifilm_found_frames"))||[],E=localStorage.getItem("anifilm_glitch_mode")==="true";const L=document.getElementById("landing-page"),I=document.getElementById("start-btn"),m=document.getElementById("ui-layer"),S=document.getElementById("collection-btn"),d=document.getElementById("collection-view"),b=document.getElementById("close-collection-btn"),u=document.getElementById("collection-grid"),v=document.getElementById("victory-screen"),c=document.getElementById("submit-btn"),f=document.querySelector("a-scene");function g(){y(),p()}I.addEventListener("click",()=>{L.classList.add("hidden"),m.classList.remove("hidden")});S.addEventListener("click",()=>{y(),d.classList.remove("hidden")});b.addEventListener("click",()=>{d.classList.add("hidden")});function y(){u.innerHTML="";for(let e=0;e<l;e++){const t=document.createElement("div");t.className="grid-item",t.id=`collection-item-${e}`,t.textContent=e+1,r.includes(e)&&t.classList.add("found"),u.appendChild(t)}}function _(e){console.log(`Target ${e} found!`),r.includes(e)||(r.push(e),localStorage.setItem("anifilm_found_frames",JSON.stringify(r)),p())}function p(){r.length>=l&&(d.classList.add("hidden"),v.classList.remove("hidden"),m.classList.add("hidden"))}function C(){for(let e=0;e<l;e++){let t=document.querySelector(`[mindar-image-target="targetIndex: ${e}"]`);if(!t){t=document.createElement("a-entity"),t.setAttribute("mindar-image-target",`targetIndex: ${e}`);const i=document.createElement("a-plane");i.setAttribute("color","lime"),i.setAttribute("opacity","0.5"),t.appendChild(i),f.appendChild(t)}t.addEventListener("targetFound",()=>_(e))}}c.addEventListener("click",async()=>{c.disabled=!0,c.textContent="Sending...";try{const e=localStorage.getItem("anifilm_user_id")||`user_${Date.now()}`;localStorage.setItem("anifilm_user_id",e);const i=await(await fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,foundAll:!0,glitchMode:E})})).json();if(i.success)c.textContent="SENT! CHECK THE TV",alert("Animation sent to the CRT Display!");else throw new Error(i.error)}catch(e){console.error(e),c.textContent="RETRY",c.disabled=!1,alert("Error sending data. Please try again.")}});g();f.addEventListener("loaded",C);window.unlockAll=()=>{r=Array.from({length:12},(e,t)=>t),localStorage.setItem("anifilm_found_frames",JSON.stringify(r)),g()};
