(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const c=12,g="http://localhost:3000/api/submit";let i=JSON.parse(localStorage.getItem("anifilm_found_frames"))||[],p=localStorage.getItem("anifilm_glitch_mode")==="true";const d=document.getElementById("grid"),y=document.getElementById("victory-screen"),s=document.getElementById("submit-btn"),u=document.querySelector("a-scene");function m(){d.innerHTML="";for(let e=0;e<c;e++){const t=document.createElement("div");t.className="grid-item",t.id=`grid-item-${e}`,t.textContent=e+1,i.includes(e)&&t.classList.add("found"),d.appendChild(t)}f()}function h(e){if(console.log(`Target ${e} found!`),!i.includes(e)){i.push(e),localStorage.setItem("anifilm_found_frames",JSON.stringify(i));const t=document.getElementById(`grid-item-${e}`);t&&t.classList.add("found"),f()}}function f(){i.length>=c&&y.classList.remove("hidden")}function E(){for(let e=0;e<c;e++){let t=document.querySelector(`[mindar-image-target="targetIndex: ${e}"]`);if(!t){t=document.createElement("a-entity"),t.setAttribute("mindar-image-target",`targetIndex: ${e}`);const r=document.createElement("a-plane");r.setAttribute("color","lime"),r.setAttribute("opacity","0.5"),t.appendChild(r),u.appendChild(t)}t.addEventListener("targetFound",()=>h(e))}}s.addEventListener("click",async()=>{s.disabled=!0,s.textContent="Sending...";try{const e=localStorage.getItem("anifilm_user_id")||`user_${Date.now()}`;localStorage.setItem("anifilm_user_id",e);const r=await(await fetch(g,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,foundAll:!0,glitchMode:p})})).json();if(r.success)s.textContent="SENT! CHECK THE TV",alert("Animation sent to the CRT Display!");else throw new Error(r.error)}catch(e){console.error(e),s.textContent="RETRY",s.disabled=!1,alert("Error sending data. Please try again.")}});m();u.addEventListener("loaded",E);window.unlockAll=()=>{i=Array.from({length:12},(e,t)=>t),localStorage.setItem("anifilm_found_frames",JSON.stringify(i)),m()};
